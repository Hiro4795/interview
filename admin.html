<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>번호 호출 관리자</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f6f8;
      text-align: center;
      margin: 0;
      padding: 20px;
    }
    h1 { font-size: 36px; }
    input {
      font-size: 24px;
      width: 100px;
      margin: 5px;
      text-align: center;
    }
    button {
      font-size: 22px;
      padding: 10px 20px;
      margin: 5px;
      cursor: pointer;
    }
    #numbers {
      margin-top: 20px;
    }
    .num-btn {
      font-size: 22px;
      width: 60px;
      height: 60px;
      margin: 5px;
    }
    .num-btn:disabled {
      background: #ccc;
      color: #666;
      cursor: not-allowed;
    }
  </style>
</head>
<body>

<h1>호출 번호 관리</h1>

<input type="number" id="start" placeholder="시작">
~
<input type="number" id="end" placeholder="끝">
<br>
<button onclick="makeRange()">범위 생성</button>
<button onclick="resetCalled()">초기화</button>

<div id="numbers"></div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyC0vy7CRKb0eCe3uflueVjVZmBbJjiL8Eo",
    authDomain: "shucall1.firebaseapp.com",
    projectId: "shucall1"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();
  const ref = db.collection("queue").doc("current");

  let buttons = {};

  // 범위 생성
  function makeRange() {
    const s = Number(start.value);
    const e = Number(end.value);

    if (!s || !e || s > e) {
      alert("범위를 올바르게 입력하세요");
      return;
    }

    const area = document.getElementById("numbers");
    area.innerHTML = "";
    buttons = {};

    for (let i = s; i <= e; i++) {
      const btn = document.createElement("button");
      btn.innerText = i;
      btn.className = "num-btn";
      btn.onclick = () => callNumber(i);
      area.appendChild(btn);
      buttons[i] = btn;
    }
  }

  // 번호 호출
  function callNumber(num) {
    ref.set({
      called: firebase.firestore.FieldValue.arrayUnion(num)
    }, { merge: true });

    buttons[num].disabled = true;
  }

  // 초기화
  function resetCalled() {
    if (!confirm("호출 목록을 초기화할까요?")) return;

    ref.set({ called: [] });

    Object.values(buttons).forEach(btn => {
      btn.disabled = false;
    });
  }

  // 새로고침/재접속 시 상태 동기화
  ref.onSnapshot(doc => {
    if (!doc.exists || !doc.data().called) return;
    const called = doc.data().called;

    Object.keys(buttons).forEach(num => {
      buttons[num].disabled = called.includes(Number(num));
    });
  });
</script>

</body>
</html>
