<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ë²ˆí˜¸ í˜¸ì¶œ ê´€ë¦¬ì</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f6f8;
      text-align: center;
      margin: 0;
      padding: 20px;
    }
    h1 { font-size: 36px; }

    input {
      font-size: 24px;
      width: 100px;
      margin: 5px;
      text-align: center;
    }
    button {
      font-size: 22px;
      padding: 10px 20px;
      margin: 5px;
      cursor: pointer;
    }
    #numbers { margin-top: 20px; }
    .num-btn {
      font-size: 22px;
      width: 60px;
      height: 60px;
      margin: 5px;
    }
    .num-btn.selected { background: #ffcc00; }
    .num-btn:disabled {
      background: #ccc;
      color: #666;
      cursor: not-allowed;
    }
    #pending { margin-top: 15px; font-size: 20px; }
  </style>
</head>
<body>

<h1>í˜¸ì¶œ ë²ˆí˜¸ ê´€ë¦¬</h1>

<input type="number" id="start" placeholder="ì‹œì‘">
~
<input type="number" id="end" placeholder="ë">
<br>
<button onclick="makeRange()">ë²”ìœ„ ìƒì„±</button>
<button onclick="callSelected()">ğŸ“¢ í˜¸ì¶œ</button>
<button onclick="clearDisplay()">ğŸ§¹ ì§€ìš°ê¸°</button>
<button onclick="resetAll()">ì´ˆê¸°í™”</button>

<div id="pending">ì„ íƒëœ ë²ˆí˜¸: ì—†ìŒ</div>
<div id="numbers"></div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyC0vy7CRKb0eCe3uflueVjVZmBbJjiL8Eo",
    authDomain: "shucall1.firebaseapp.com",
    projectId: "shucall1"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();
  const ref = db.collection("queue").doc("roomA");

  let buttons = {};
  let pending = [];
  let calledAll = [];
  let callSeq = 0;

  function updatePendingView() {
    document.getElementById("pending").innerText =
      pending.length ? `ì„ íƒëœ ë²ˆí˜¸: ${pending.join(", ")}` : "ì„ íƒëœ ë²ˆí˜¸: ì—†ìŒ";
  }

  // âœ… ë²”ìœ„ ìƒì„± (ìˆ˜ì •ëœ í•µì‹¬ ë¶€ë¶„)
  function makeRange() {
    const s = Number(document.getElementById("start").value);
    const e = Number(document.getElementById("end").value);

    if (!s || !e || s > e) {
      alert("ë²”ìœ„ë¥¼ ì˜¬ë°”ë¥´ê²Œ ì…ë ¥í•˜ì„¸ìš”");
      return;
    }

    const area = document.getElementById("numbers");
    area.innerHTML = "";
    buttons = {};
    pending = [];
    updatePendingView();

    for (let i = s; i <= e; i++) {
      const btn = document.createElement("button");
      btn.innerText = i;
      btn.className = "num-btn";
      btn.onclick = () => toggleSelect(i);
      area.appendChild(btn);
      buttons[i] = btn;
    }

    syncButtons();
  }

  function toggleSelect(num) {
    if (calledAll.includes(num)) return;

    if (pending.includes(num)) {
      pending = pending.filter(n => n !== num);
      buttons[num].classList.remove("selected");
    } else {
      pending.push(num);
      buttons[num].classList.add("selected");
    }
    updatePendingView();
  }

  function callSelected() {
    if (pending.length === 0) {
      alert("í˜¸ì¶œí•  ë²ˆí˜¸ë¥¼ ì„ íƒí•˜ì„¸ìš”");
      return;
    }

    callSeq++;

    ref.set({
      calledAll: firebase.firestore.FieldValue.arrayUnion(...pending),
      display: pending,
      callSeq: callSeq
    }, { merge: true });

    pending = [];
    updatePendingView();
  }

  function clearDisplay() {
    ref.set({ display: [] }, { merge: true });
  }

  function resetAll() {
    if (!confirm("ì „ì²´ë¥¼ ì´ˆê¸°í™”í• ê¹Œìš”?")) return;

    callSeq = 0;

    ref.set({
      calledAll: [],
      display: [],
      callSeq: 0
    });

    pending = [];
    updatePendingView();

    Object.values(buttons).forEach(btn => {
      btn.disabled = false;
      btn.classList.remove("selected");
    });
  }

  function syncButtons() {
    Object.keys(buttons).forEach(num => {
      const n = Number(num);
      buttons[n].disabled = calledAll.includes(n);
      buttons[n].classList.remove("selected");
    });
  }

  // Firestore ë™ê¸°í™”
  ref.onSnapshot(doc => {
    if (!doc.exists) {
      calledAll = [];
      callSeq = 0;
    } else {
      calledAll = doc.data().calledAll || [];
      callSeq = doc.data().callSeq || 0;
    }
    syncButtons();
  });
</script>

</body>
</html>
